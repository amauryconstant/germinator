[tools]
go = "1.25.5"
golangci-lint = "2.8.0"
goreleaser = "2.13.3"
pre-commit = "latest"

# ========================
# Build Tasks
# ========================

[tasks.build]
description = "Build CLI to bin/germinator"
depends = ["build:clean"]
run = "mkdir -p bin && go build -ldflags=\"-X gitlab.com/amoconst/germinator/internal/version.Version=$(git describe --tags --always --dirty 2>/dev/null || echo dev) -X gitlab.com/amoconst/germinator/internal/version.Commit=$(git rev-parse HEAD 2>/dev/null || echo unknown) -X gitlab.com/amoconst/germinator/internal/version.Date=$(date +%Y-%m-%d)\" -o bin/germinator ./cmd"
sources = ["cmd/**/*.go", "internal/**/*.go", "pkg/**/*.go"]
outputs = ["bin/germinator"]

[tasks."build:local"]
description = "Build and install germinator locally for testing"
run = "mkdir -p $HOME/.local/bin && go build -ldflags=\"-X gitlab.com/amoconst/germinator/internal/version.Version=$(git describe --tags --always --dirty 2>/dev/null || echo dev)\" -o $HOME/.local/bin/germinator ./cmd"

[tasks."build:clean"]
description = "Clean build artifacts"
run = "rm -rf bin/* dist/* coverage.out coverage.html"

# ========================
# Code Quality & Test Tasks
# ========================

[tasks.lint]
description = "Run linting checks"
run = "golangci-lint run"

[tasks."lint:fix"]
description = "Auto-fix linting issues"
run = "golangci-lint run --fix"

[tasks.format]
description = "Format Go code"
run = "gofmt -w ."

[tasks.test]
description = "Run all tests"
run = "go test ./..."

[tasks."test:coverage"]
description = "Run tests with coverage"
run = "go test ./... -cover -v"

[tasks.check]
description = "Run all validation checks"
depends = ["lint", "format", "test", "build"]

# ========================
# Release Management
# ========================

[tasks."release:dry-run"]
description = "Test GoReleaser without creating release"
run = "goreleaser release --skip=publish --clean"

# Note: CI Docker image is built automatically by GitLab CI when Dockerfile.ci or .mise/config.toml changes